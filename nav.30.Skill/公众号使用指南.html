<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>公众号使用指南 | Payton&#39;s blog</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Somewhere Leisure.">
    
    <link rel="preload" href="/myblog/assets/css/0.styles.ff793384.css" as="style"><link rel="preload" href="/myblog/assets/js/app.a3c84fc1.js" as="script"><link rel="preload" href="/myblog/assets/js/2.fdea671f.js" as="script"><link rel="preload" href="/myblog/assets/js/32.5a47fa8d.js" as="script"><link rel="prefetch" href="/myblog/assets/js/10.7847a5a3.js"><link rel="prefetch" href="/myblog/assets/js/11.b2785f97.js"><link rel="prefetch" href="/myblog/assets/js/12.81ffdcd9.js"><link rel="prefetch" href="/myblog/assets/js/13.b8376775.js"><link rel="prefetch" href="/myblog/assets/js/14.21be6db8.js"><link rel="prefetch" href="/myblog/assets/js/15.e4845df9.js"><link rel="prefetch" href="/myblog/assets/js/16.26e7b236.js"><link rel="prefetch" href="/myblog/assets/js/17.3e01733a.js"><link rel="prefetch" href="/myblog/assets/js/18.cd9f5deb.js"><link rel="prefetch" href="/myblog/assets/js/19.4fc7fa6b.js"><link rel="prefetch" href="/myblog/assets/js/20.d624b5e1.js"><link rel="prefetch" href="/myblog/assets/js/21.879b982f.js"><link rel="prefetch" href="/myblog/assets/js/22.10fcb746.js"><link rel="prefetch" href="/myblog/assets/js/23.6e98a037.js"><link rel="prefetch" href="/myblog/assets/js/24.89f1d957.js"><link rel="prefetch" href="/myblog/assets/js/25.f0710c91.js"><link rel="prefetch" href="/myblog/assets/js/26.957bef02.js"><link rel="prefetch" href="/myblog/assets/js/27.df27e33f.js"><link rel="prefetch" href="/myblog/assets/js/28.e02cd141.js"><link rel="prefetch" href="/myblog/assets/js/29.6788de2d.js"><link rel="prefetch" href="/myblog/assets/js/3.e5125461.js"><link rel="prefetch" href="/myblog/assets/js/30.61ba9f3d.js"><link rel="prefetch" href="/myblog/assets/js/31.166de6f1.js"><link rel="prefetch" href="/myblog/assets/js/33.f9e473c5.js"><link rel="prefetch" href="/myblog/assets/js/34.0f3b4e36.js"><link rel="prefetch" href="/myblog/assets/js/35.2be1f820.js"><link rel="prefetch" href="/myblog/assets/js/36.87a9ea06.js"><link rel="prefetch" href="/myblog/assets/js/37.24a4b907.js"><link rel="prefetch" href="/myblog/assets/js/38.a0e80546.js"><link rel="prefetch" href="/myblog/assets/js/4.d37862ef.js"><link rel="prefetch" href="/myblog/assets/js/5.1cfadda0.js"><link rel="prefetch" href="/myblog/assets/js/6.73c063ed.js"><link rel="prefetch" href="/myblog/assets/js/7.b4e343ac.js"><link rel="prefetch" href="/myblog/assets/js/8.91d031eb.js"><link rel="prefetch" href="/myblog/assets/js/9.40a34877.js">
    <link rel="stylesheet" href="/myblog/assets/css/0.styles.ff793384.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/myblog/" class="home-link router-link-active"><img src="icon.png" alt="Payton's blog" class="logo"> <span class="site-name can-hide">Payton's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/myblog/nav.10.World/" class="nav-link">
  World
</a></div><div class="nav-item"><a href="/myblog/nav.20.Technology/" class="nav-link">
  Technology
</a></div><div class="nav-item"><a href="/myblog/nav.30.Skill/" class="nav-link router-link-active">
  Skill
</a></div><div class="nav-item"><a href="/myblog/nav.40.Study/" class="nav-link">
  Study
</a></div><div class="nav-item"><a href="/myblog/nav.50.Other/" class="nav-link">
  Other
</a></div> <a href="https://github.com/paytonguan/myblog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/myblog/nav.10.World/" class="nav-link">
  World
</a></div><div class="nav-item"><a href="/myblog/nav.20.Technology/" class="nav-link">
  Technology
</a></div><div class="nav-item"><a href="/myblog/nav.30.Skill/" class="nav-link router-link-active">
  Skill
</a></div><div class="nav-item"><a href="/myblog/nav.40.Study/" class="nav-link">
  Study
</a></div><div class="nav-item"><a href="/myblog/nav.50.Other/" class="nav-link">
  Other
</a></div> <a href="https://github.com/paytonguan/myblog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/myblog/nav.30.Skill/" aria-current="page" class="sidebar-link">前言</a></li><li><a href="/myblog/nav.30.Skill/Git和Github的安装与使用.html" class="sidebar-link">Git和Github的安装与使用</a></li><li><a href="/myblog/nav.30.Skill/Kindle的使用.html" class="sidebar-link">Kindle的使用</a></li><li><a href="/myblog/nav.30.Skill/Matlab的使用.html" class="sidebar-link">Matlab的使用</a></li><li><a href="/myblog/nav.30.Skill/Node环境的搭建与使用.html" class="sidebar-link">Node环境的搭建与使用</a></li><li><a href="/myblog/nav.30.Skill/Sublime 3的使用.html" class="sidebar-link">Sublime 3的使用</a></li><li><a href="/myblog/nav.30.Skill/个人博客的搭建.html" class="sidebar-link">个人博客的搭建</a></li><li><a href="/myblog/nav.30.Skill/全平台使用技巧总结.html" class="sidebar-link">全平台使用技巧总结</a></li><li><a href="/myblog/nav.30.Skill/公众号使用指南.html" class="active sidebar-link">公众号使用指南</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/nav.30.Skill/公众号使用指南.html#编辑器自动保存" class="sidebar-link">编辑器自动保存</a></li><li class="sidebar-sub-header"><a href="/myblog/nav.30.Skill/公众号使用指南.html#markdown-to-公众号一键转换器" class="sidebar-link">Markdown to 公众号一键转换器</a></li><li class="sidebar-sub-header"><a href="/myblog/nav.30.Skill/公众号使用指南.html#服务器绑定" class="sidebar-link">服务器绑定</a></li><li class="sidebar-sub-header"><a href="/myblog/nav.30.Skill/公众号使用指南.html#公众号开发指南" class="sidebar-link">公众号开发指南</a></li></ul></li><li><a href="/myblog/nav.30.Skill/程序员工具集合及使用.html" class="sidebar-link">程序员工具集合及使用</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk7x9t5no2j30yk0jgwki.jpg" alt=""></p> <p>公众号开发可以为其提供新的功能。</p> <h1 id="图文排版"><a href="#图文排版" class="header-anchor">#</a> 图文排版</h1> <h2 id="编辑器自动保存"><a href="#编辑器自动保存" class="header-anchor">#</a> 编辑器自动保存</h2> <p>点击Chrome浏览器的TamperMonkey扩展程序，选择<code>添加新脚本</code>，复制以下内容并保存即可。</p> <div class="language- extra-class"><pre class="language-text"><code>// ==UserScript==
// @name         微信推文编辑器自动保存
// @version      0.1
// @description  微信推文编辑器自动保存
// @author       内咸禾方皇
// @match        https://mp.weixin.qq.com/*
// @grant        none
// @run-at       document-end
// ==/UserScript==
(function() {
    'use strict';
    var time = window.setInterval(function(){document.querySelector(&quot;#js_submit&quot;).click()},60000);
})();
</code></pre></div><h2 id="markdown-to-公众号一键转换器"><a href="#markdown-to-公众号一键转换器" class="header-anchor">#</a> Markdown to 公众号一键转换器</h2> <p>可用Markdown语法进行公众号排版。打开以下链接，完成编写后点击转换，然后将预览区中的内容复制到微信图文编辑器即可。</p> <div class="language- extra-class"><pre class="language-text"><code>https://knb.im/mp/
</code></pre></div><h1 id="公众号开发"><a href="#公众号开发" class="header-anchor">#</a> 公众号开发</h1> <h2 id="服务器绑定"><a href="#服务器绑定" class="header-anchor">#</a> 服务器绑定</h2> <p>服务器用于处理发送到公众号的消息请求，并完成消息发送。</p> <p>准备好VPS后通过SSH连接，以CentOS为例，进入root用户后执行以下命令以安装必要依赖。</p> <div class="language- extra-class"><pre class="language-text"><code>yum install vim
yum install libxml2
yum install libxslt
yum install python
pip install --upgrade pip

# 对于python2
pip install web.py==0.51
# 对于python3
pip install web.py

pip install lxml
</code></pre></div><p>完成后输入以下命令新建py文件。</p> <div class="language- extra-class"><pre class="language-text"><code>vim main.py
</code></pre></div><p>内容如下。</p> <div class="language- extra-class"><pre class="language-text"><code># -*- coding: utf-8 -*-
# filename: main.py
import web
from handle import Handle

urls = (
    '/wx', 'Handle',
)

if __name__ == '__main__':
    app = web.application(urls, globals())
    app.run()
</code></pre></div><p>保存后继续新建文件。</p> <div class="language- extra-class"><pre class="language-text"><code>vim handle.py
</code></pre></div><p>内容如下，其中token可任意填写。</p> <div class="language- extra-class"><pre class="language-text"><code># -*- coding: utf-8 -*-
# filename: handle.py

import hashlib
import web

class Handle(object):
    def GET(self):
        try:
            data = web.input()
            if len(data) == 0:
                return &quot;hello, this is handle view&quot;
            signature = data.signature
            timestamp = data.timestamp
            nonce = data.nonce
            echostr = data.echostr
            token = &quot;xxxx&quot; #可任意

            list = [token, timestamp, nonce]
            list.sort()
            sha1 = hashlib.sha1()
            map(sha1.update, list)
            hashcode = sha1.hexdigest()
            print &quot;handle/GET func: hashcode, signature: &quot;, hashcode, signature
            if hashcode == signature:
                return echostr
            else:
                return &quot;&quot;
        except Exception, Argument:
            return Argument
</code></pre></div><p>保存后运行以下命令执行脚本。如果提示socket错误，则需要开启80端口。</p> <div class="language- extra-class"><pre class="language-text"><code>python main.py 80
</code></pre></div><p>在浏览器输入以下链接以访问刚才运行脚本所搭建的网页，若显示<code>hello, this is handle view</code>，则成功。</p> <div class="language- extra-class"><pre class="language-text"><code>http://[外网IP]/wx
</code></pre></div><p>进入公众号后台并选择开发-基本配置-修改配置，内容如下，然后提交即可。</p> <table><thead><tr><th>选项</th> <th>内容</th></tr></thead> <tbody><tr><td>URL</td> <td>http://[外网IP]/wx</td></tr> <tr><td>Token</td> <td>刚才填写的内容</td></tr> <tr><td>消息加解密方式</td> <td>明文模式</td></tr></tbody></table> <h1 id="参考教程"><a href="#参考教程" class="header-anchor">#</a> 参考教程</h1> <h2 id="公众号开发指南"><a href="#公众号开发指南" class="header-anchor">#</a> 公众号开发指南</h2> <div class="language- extra-class"><pre class="language-text"><code>https://developers.weixin.qq.com/doc/offiaccount/Getting_Started/Getting_Started_Guide.html
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/myblog/nav.30.Skill/全平台使用技巧总结.html" class="prev">
        全平台使用技巧总结
      </a></span> <span class="next"><a href="/myblog/nav.30.Skill/程序员工具集合及使用.html">
        程序员工具集合及使用
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/myblog/assets/js/app.a3c84fc1.js" defer></script><script src="/myblog/assets/js/2.fdea671f.js" defer></script><script src="/myblog/assets/js/32.5a47fa8d.js" defer></script>
  </body>
</html>
